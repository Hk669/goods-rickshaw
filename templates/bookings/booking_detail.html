<!-- templates/bookings/booking_detail.html -->
{% extends "base.html" %}

{% block content %}
  <h2>Booking Details</h2>
  <p><strong>Pickup Address:</strong> {{ booking.pickup_address }}</p>
  <p><strong>Drop-off Address:</strong> {{ booking.dropoff_address }}</p>
  <p><strong>Vehicle Type:</strong> {{ booking.vehicle_type.name }}</p>
  <p><strong>Price:</strong> ${{ booking.price }}</p>
  <p><strong>Status:</strong> {{ booking.get_status_display }}</p>

  {% if user.role == 'driver' and booking.status == 'PENDING' %}
    <button id="accept-booking" data-booking-id="{{ booking.id }}">Accept Booking</button>
  {% endif %}

  <script>
    document.getElementById('accept-booking').addEventListener('click', function() {
        const bookingId = this.dataset.bookingId;
        fetch("{% url 'accept_booking' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: `booking_id=${bookingId}`
        })
        .then(response => response.json())
        .then(data => {
            if(data.status === 'success') {
                alert('Booking accepted successfully.');
                // Optionally, redirect or update the UI
            } else {
                alert(`Error: ${data.message}`);
            }
        })
        .catch(error => console.error('Error:', error));
    });
  </script>
{% endblock %}
